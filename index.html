<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suite de Generadores Educativos</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="/style.css">

    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <div id="page-container">
        <div id="auth-view">
            <div class="min-h-screen grid lg:grid-cols-2">

                <div class="hidden lg:block bg-cover bg-center" style="background-image: url('images/login-bg.png');">
                </div>

                <div class="flex items-center justify-center p-4 sm:p-8 lg:p-12 bg-white">
                    <div class="w-full max-w-md">

                        <div id="login-screen">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-gray-800">BIENVENIDO A LA SUITE DOCENTE</h1>
                                <p class="text-gray-500 mt-2">Inicia sesión para acceder a los generadores, solo
                                    necesitas registrarte, <strong>¡ES GRATIS!</strong></p>
                            </div>

                            <div class="space-y-4">
                                <button id="google-login-btn" type="button"
                                    class="w-full h-[52px] flex items-center justify-center font-semibold text-lg text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
                                    <svg class="w-5 h-5 mr-3" viewBox="0 0 48 48">
                                        <path fill="#FFC107"
                                            d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z">
                                        </path>
                                        <path fill="#FF3D00"
                                            d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z">
                                        </path>
                                        <path fill="#4CAF50"
                                            d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.522-3.441-11.022-8.12l-6.522,5.025C9.505,39.556,16.227,44,24,44z">
                                        </path>
                                        <path fill="#1976D2"
                                            d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.022,35.132,44,30.028,44,24C44,22.659,43.862,21.35,43.611,20.083z">
                                        </path>
                                    </svg>
                                    Inicia Sesión con Google
                                </button>
                                <button id="facebook-login-btn" type="button"
                                    class="w-full h-[52px] flex items-center justify-center font-semibold text-lg text-white bg-[#1877F2] border border-transparent rounded-lg hover:bg-[#166fe5] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-1.5c-.83 0-1 .42-1 1v2h2.5l-.5 3H14v6.8c4.56-.93 8-4.96 8-9.8z">
                                        </path>
                                    </svg>
                                    Inicia Sesión con Facebook
                                </button>
                            </div>




                            <p id="login-error" class="text-red-500 text-center hidden mt-4 text-sm"></p>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <main id="suite-dashboard" class="hidden min-h-screen p-4 sm:p-8">
            <header class="flex justify-between items-center mb-12 max-w-7xl mx-auto">
                <div class="text-left">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Suite de Generadores</h1>
                    <p id="user-greeting" class="text-gray-600">Bienvenido/a.</p>
                </div>
                <button id="logout-button"
                    class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">Cerrar
                    Sesión</button>
            </header>
            <div id="generator-grid"
                class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto">
                <a href="https://glistening-starlight-1588bf.netlify.app/"
                    class="generator-card bg-sky-50 border-2 border-sky-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="book-open-check"
                            class="lucide text-sky-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Generador de Sesiones V-2.0</h3>
                        <p class="text-gray-500 text-sm flex-grow">Crea tu sesión de aprendizaje completa en un solo
                            clic.</p>
                    </div>
                </a>
                <a href="https://unidades2.netlify.app/" class="generator-card bg-indigo-50 border-2 border-indigo-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="layers-3"
                            class="lucide text-indigo-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Generador de Unidades V-2.0</h3>
                        <p class="text-gray-500 text-sm flex-grow">Diseña unidades de aprendizaje listas para
                            implementar.</p>
                    </div>
                </a>
                <a href="https://jazzy-moxie-e34a66.netlify.app/"
                    class="generator-card bg-emerald-50 border-2 border-emerald-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="file-spreadsheet"
                            class="lucide text-emerald-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Fichas y Exámenes</h3>
                        <p class="text-gray-500 text-sm flex-grow">Genera material de trabajo y evaluaciones al
                            instante.</p>
                    </div>
                </a>
                <a href="https://fancy-profiterole-01445b.netlify.app/"
                    class="generator-card bg-amber-50 border-2 border-amber-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="file-signature"
                            class="lucide text-amber-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Generador de Solicitudes</h3>
                        <p class="text-gray-500 text-sm flex-grow">Redacta documentos administrativos de forma
                            automática.</p>
                    </div>
                </a>
                <a href="https://elegant-duckanoo-d702fe.netlify.app/"
                    class="generator-card bg-rose-50 border-2 border-rose-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="shield-check"
                            class="lucide text-rose-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Solucionador de Conflictos</h3>
                        <p class="text-gray-500 text-sm flex-grow">Guía para actuar en situaciones de conflicto según
                            normativas.</p>
                    </div>
                </a>
                <a href="https://jocular-concha-e30cbd.netlify.app/"
                    class="generator-card bg-violet-50 border-2 border-violet-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="puzzle"
                            class="lucide text-violet-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Proyectos Integrados</h3>
                        <p class="text-gray-500 text-sm flex-grow">Desarrolla proyectos de aprendizaje basados en
                            problemas reales.</p>
                    </div>
                </a>
                <a href="https://unrivaled-unicorn-fe7373.netlify.app/"
                    class="generator-card bg-teal-50 border-2 border-teal-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="calendar-days"
                            class="lucide text-teal-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Programación Anual</h3>
                        <p class="text-gray-500 text-sm flex-grow">Genera tu programación curricular anual de forma
                            sencilla.</p>
                    </div>
                </a>
                <a href="https://stalwart-buttercream-8c9f0d.netlify.app/"
                    class="generator-card bg-orange-50 border-2 border-orange-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="notebook-pen"
                            class="lucide text-orange-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Registros Auxiliares</h3>
                        <p class="text-gray-500 text-sm flex-grow">Gestiona y crea registros de notas de forma
                            automática.</p>
                    </div>
                </a>
                <a href="https://carpetasderecuperacion.netlify.app/"
                    class="generator-card bg-cyan-50 border-2 border-cyan-200">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="folder-sync"
                            class="lucide text-cyan-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Carpetas de Recuperación</h3>
                        <p class="text-gray-500 text-sm flex-grow">Crea planes y materiales para el periodo de
                            recuperación.</p>
                    </div>
                </a>
                <a href="https://play.google.com/store/apps/details?id=com.juancaicedo.maestros"
                    class="generator-card bg-lime-50 border-2 border-lime-200" target="_blank"
                    rel="noopener noreferrer">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="smartphone"
                            class="lucide text-lime-600 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Descarga Nuestra App</h3>
                        <p class="text-gray-500 text-sm flex-grow">Lleva la suite contigo a todas partes en tu móvil.
                        </p>
                    </div>
                </a>
                <a href="#"
                    class="generator-card is-disabled bg-slate-50 border-2 border-slate-200 opacity-75 hover:opacity-100">
                    <div class="p-6 h-full flex flex-col items-center text-center"> <i data-lucide="hourglass"
                            class="lucide text-slate-500 mb-4"></i>
                        <h3 class="text-xl font-bold mb-2 text-gray-800">Próximamente</h3>
                        <p class="text-gray-500 text-sm flex-grow">Estamos preparando una nueva y potente herramienta
                            para ti.</p>
                    </div>
                </a>
            </div>
        </main>
    </div>

    <div id="email-confirmation-modal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div
            class="bg-white rounded-2xl shadow-xl p-8 sm:p-12 text-center max-w-md mx-auto transform transition-all scale-95 opacity-0 animate-fade-in-scale">
            <i data-lucide="mail-check" class="mx-auto text-green-600 mb-4"
                style="width: 4rem; height: 4rem; stroke-width: 1.5;"></i>
            <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">¡Casi listo! Revisa tu correo</h2>
            <p class="text-gray-600 mb-8">Te hemos enviado un enlace de confirmación. Haz clic en él para activar tu
                cuenta y poder iniciar sesión. El remitente es **Firebase**.</p>
            <button id="accept-confirmation-btn"
                class="w-full h-[52px] flex items-center justify-center font-semibold text-lg text-white rounded-lg primary-button">Aceptar</button>
        </div>
    </div>

    <div id="welcome-message-modal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-xl p-8 sm:p-12 text-center max-w-md mx-auto animate-fade-in-scale">
            <i data-lucide="gift" class="mx-auto text-teal-600 mb-4"
                style="width: 4rem; height: 4rem; stroke-width: 1.5;"></i>
            <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-3">¡Bienvenido a la Suite Docente!</h2>
            <p class="text-gray-600 text-lg mb-8">
                Este es un aporte del <strong>Prof. CAICEDO</strong> para la comunidad educativa.
            </p>
            <button id="accept-welcome-btn"
                class="w-full h-[52px] flex items-center justify-center font-semibold text-lg text-white rounded-lg primary-button">OK</button>
        </div>
    </div>

    <div id="generator-modal"
        class="hidden fixed inset-0 bg-gray-900 bg-opacity-90 z-40 flex flex-col p-2 sm:p-4 md:p-6">
        <div class="w-full flex justify-end flex-shrink-0 mb-2">
            <button id="close-generator-btn"
                class="bg-red-600 hover:bg-red-700 text-white rounded-full p-2 transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white">
                <i data-lucide="x" class="h-6 w-6"></i>
            </button>
        </div>
        <div class="flex-grow bg-white rounded-lg overflow-hidden iframe-container">
            <iframe id="generator-iframe" class="w-full h-full border-0" title="Generador"></iframe>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- REFERENCIAS A ELEMENTOS DEL DOM ---
            const authView = document.getElementById('auth-view');
            const suiteDashboard = document.getElementById('suite-dashboard');
            const loginError = document.getElementById('login-error');
            const userGreeting = document.getElementById('user-greeting');
            const logoutButton = document.getElementById('logout-button');

            // Botones de inicio de sesión
            const googleLoginBtn = document.getElementById('google-login-btn');
            const facebookLoginBtn = document.getElementById('facebook-login-btn');

            // Modales y generadores
            const welcomeMessageModal = document.getElementById('welcome-message-modal');
            const acceptWelcomeBtn = document.getElementById('accept-welcome-btn');
            const generatorModal = document.getElementById('generator-modal');
            const closeGeneratorBtn = document.getElementById('close-generator-btn');
            const generatorIframe = document.getElementById('generator-iframe');
            const generatorGrid = document.getElementById('generator-grid');

            // --- FUNCIONES AUXILIARES ---
            function showMessage(element, message, isError = true) {
                element.textContent = message;
                element.className = `text-center mt-4 text-sm ${isError ? 'text-red-500' : 'text-green-600'}`;
                element.classList.remove('hidden');
            }

            function handleSuccessfulLogin(user) {
                const userName = user.displayName || user.email || 'Docente';
                userGreeting.textContent = `Bienvenido/a, ${userName}.`;

                if (!sessionStorage.getItem('welcomeShown')) {
                    welcomeMessageModal.classList.remove('hidden');
                    lucide.createIcons();
                } else {
                    authView.classList.add('hidden');
                    suiteDashboard.classList.remove('hidden');
                }
            }

            // --- LÓGICA DE AUTENTICACIÓN ---

            // Observador de estado de autenticación (el cerebro de todo)
            window.onAuthStateChanged(window.firebaseAuth, (user) => {
                if (user) {
                    // Si hay un usuario, muéstrale el dashboard
                    handleSuccessfulLogin(user);
                } else {
                    // Si no hay usuario, muestra la pantalla de login
                    authView.classList.remove('hidden');
                    suiteDashboard.classList.add('hidden');
                    loginError.classList.add('hidden');
                }
            });

            // Event Listener para el botón de Google
            googleLoginBtn.addEventListener('click', async () => {
                loginError.classList.add('hidden');
                const provider = new window.GoogleAuthProvider();
                try {
                    await window.signInWithPopup(window.firebaseAuth, provider);
                } catch (error) {
                    if (error.code !== 'auth/popup-closed-by-user') {
                        showMessage(loginError, 'No se pudo iniciar sesión con Google.');
                        console.error("Google Sign-In Error:", error);
                    }
                }
            });

            // Event Listener para el botón de Facebook
            facebookLoginBtn.addEventListener('click', async () => {
                loginError.classList.add('hidden');
                const provider = new window.FacebookAuthProvider();
                try {
                    await window.signInWithPopup(window.firebaseAuth, provider);
                } catch (error) {
                    if (error.code !== 'auth/popup-closed-by-user') {
                        showMessage(loginError, 'No se pudo iniciar sesión con Facebook.');
                        console.error("Error de inicio de sesión con Facebook:", error);
                    }
                }
            });

            // Event Listener para cerrar sesión
            logoutButton.addEventListener('click', async () => {
                sessionStorage.removeItem('welcomeShown');
                await window.signOut(window.firebaseAuth);
            });


            // --- LÓGICA DE LA INTERFAZ (MODALES Y GENERADORES) ---

            acceptWelcomeBtn.addEventListener('click', () => {
                welcomeMessageModal.classList.add('hidden');
                sessionStorage.setItem('welcomeShown', 'true');
                authView.classList.add('hidden');
                suiteDashboard.classList.remove('hidden');
            });

            generatorGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.generator-card');
                if (card && !card.classList.contains('is-disabled') && !card.hasAttribute('target')) {
                    e.preventDefault();
                    if (window.firebaseAuth.currentUser) {
                        generatorIframe.src = `${card.href}?autorizado=true`;
                        generatorModal.classList.remove('hidden');
                        document.body.style.overflow = 'hidden';
                        lucide.createIcons();
                    }
                }
            });

            closeGeneratorBtn.addEventListener('click', () => {
                generatorModal.classList.add('hidden');
                generatorIframe.src = 'about:blank';
                document.body.style.overflow = 'auto';
            });
        });
    </script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import {
            getAuth,
            onAuthStateChanged,
            signOut,
            updateProfile,
            GoogleAuthProvider,
            FacebookAuthProvider,
            signInWithPopup
        } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

        // --- Tu configuración de Firebase (sin cambios) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC-Og-9Ju4aWSbmwa6b4OpoHzjPzd073VI",
            authDomain: "auth.caicedoeduca.com",
            projectId: "delta-cortex-437020-h5",
            storageBucket: "delta-cortex-437020-h5.appspot.com",
            messagingSenderId: "423600255022",
            appId: "1:423600255022:web:210337d8730803c500afbf",
            measurementId: "G-2KJ74JH382"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Hacemos que auth y las funciones necesarias estén disponibles globalmente
        window.firebaseAuth = auth;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.FacebookAuthProvider = FacebookAuthProvider;
        window.signInWithPopup = signInWithPopup;
        window.onAuthStateChanged = onAuthStateChanged;
        window.signOut = signOut;
        window.updateProfile = updateProfile;
    </script>
</body>

</html>